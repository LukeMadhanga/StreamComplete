!function(a,b,c,d){"use strict";function h(a,b){return{name:"StreamComplete::"+a,level:"Cannot continue",message:b,htmlMessage:b,toString:function(){return["StreamComplete::",a," - ",b].join("")}}}function i(){a(".streamcomplete-body").length||a("body").append('<div class="streamcomplete-body"></div>')}var e=null,f=function(){},g={init:function(g){function p(a){switch(Object.prototype.toString.call(a)){case"[object String]":a={id:u,value:a}}return!a.label&&a.value&&(a.label=a.value),!a.value&&a.label&&(a.value=a.label),a}var h=this,j={instanceid:++b,s:a.fn.extend({delay:250,minlength:2,onajaxerror:f,onbeforeajaxsearch:f,onbeforesearch:f,onclose:f,onerror:f,oninit:f,onresponse:f,onsearch:f,onselect:f,src:[]},g),searchterm:null},k=!1,l=!1,m={DOWN:40,ENTER:13,SPACE:32,TAB:9,UP:38,ESC:27},n=-1,o=!1;if(!h.length||h.data("streamcomplete"))return h;if(h.length>1)return h.each(function(){a(this).streamComplete(g)}),h;j.renderResult=function(b){var c=d.createElement("div");return a(c).html(b.label).data("sc-desc",b).addClass("streamcomplete-result"),c},j.render=function(b){var c=a(".streamcomplete-body").show(),d=h.offset(),e=h[0].getBoundingClientRect();a(".streamcomplete-body").data({"sc-results":b}),c.css({width:e.width,top:d.top+e.height,left:d.left}).empty();for(var f=0;b?f<b.length:0;f++){var g=p(b[f]),i=j.renderResult(g);c.append(i)}},j.afterRender=function(){var b=a(".streamcomplete-body"),c=b.data("sc-results");b.data("sc-results",c),a("body").unbind("click.streamcomplete").bind("click.streamcomplete",j.close)},j.close=function(b){var c=null;if(b){var d=a(b.target),e=d.data("streamcomplete");if(d.closest(".streamcomplete-body").length){var c=d.data("sc-desc");if(j.s.onselect.call(h,c)===!1)return!1;h[0].value=c.value,h.data("value",c.id)}else if(e&&e.instanceid===j.instanceid)return b.preventDefault(),!1;a("body").unbind("click.streamcomplete")}j.s.onclose.call(h,{selection:c,results:a(".streamcomplete-body").hide().data("sc-results")||[]})},h.keydown(function(a){if(r(m,a.which)){var b=s(a.which);if(b===!1)return a.preventDefault(),o=!0,!1}}),j.returnSource=function(a){return j.s.onsearch.call(h,a)!==!1&&(j.render(a),void j.afterRender())},h.focus(function(){var b=a(".streamcomplete-body").data("sc-results");b&&b.length&&(j.render(b),j.afterRender())}),h.keyup(function(){if(o)return o=!1,!1;j.searchterm=this.value;var b={term:j.searchterm};return n=-1,j.s.onbeforesearch.call(h,b)!==!1&&(this.value.length>=+j.s.minlength?(l=!1,k!==!1&&c.clearTimeout(k),k=c.setTimeout(function(){if(l)return void(l=!1);switch(a(".streamcomplete-body").data({"sc-results":[]}),Object.prototype.toString.call(j.s.src)){case"[object String]":q(j.s.src,b);break;case"[object Function]":j.s.src(j.searchterm,j.returnSource);break;case"[object Array]":var f,g,c=j.s.src,d=new RegExp(j.searchterm.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"i"),e=[];for(f=0;f<c.length;f++)g=p(c[f]),g.value.match(d)&&(e[e.length]=g);if(j.s.onsearch.call(h,e)===!1)return!1;j.render(e),j.afterRender()}},+j.s.delay)):(l=!0,j.close()),void h.data("streamcomplete",j))});for(var q=function(b,c){e&&e.abort(),e=a.ajax({url:b,type:"post",dataType:"json",beforeSend:function(a){j.s.onbeforeajaxsearch.call(h,a)},data:{payload:JSON.stringify(c)}}).always(function(){e=null}).done(function(a){if("OK"===a.result){if(l)return void(l=!1);if(j.s.onresponse.call(h,a)===!1)return!1;if(k=!1,j.s.onsearch.call(h,a.data)===!1)return!1;j.render(a.data),j.afterRender()}else j.s.onerror.call(h,a)}).fail(function(a){j.s.onajaxerror.call(h,a)})},r=function(a,b){for(var c in a)if(a[c]===b)return!0;return!1},s=function(b){var c=a(".streamcomplete-result"),d=c.length;switch(b){case m.UP:return n=(n-1<0?d:n)-1,a(".streamcomplete-result-hover").removeClass("streamcomplete-result-hover"),a(c[n]).addClass("streamcomplete-result-hover"),!1;case m.DOWN:return n=n+1===d?0:n+1,a(".streamcomplete-result-hover").removeClass("streamcomplete-result-hover"),a(c[n]).addClass("streamcomplete-result-hover"),!1;case m.SPACE:case m.ENTER:case m.TAB:var e=a(".streamcomplete-result-hover");return!e.length||(a(".streamcomplete-result-hover").removeClass("streamcomplete-result-hover"),j.close({target:e[0]}),!1);case m.ESC:var e=a(".streamcomplete-result-hover");return!e.length||(n=-1,a(".streamcomplete-result-hover").removeClass("streamcomplete-result-hover"),!1)}},t=["focusin","focusout"],u=0;u<t.length;u++){var v=t[u];h[v](function(b){var c=a(this).data("streamcomplete");"[object Function]"===Object.prototype.toString.call(c.s["on"+b.type])&&c.s["on"+b.type].call(this,b)})}return h.data("streamcomplete",j),i(),j.s.oninit.call(h),h},setValue:function(b){var c=this;if(c.length>1)return c.each(function(){a(this).streamComplete("clearValue")}),c;var d=c.data("streamcomplete");if(!d)throw h("InstanceError","A call to 'setValue' on an uninitialised object");c[0].value=b.value,c.data("value",b.id);for(var e in b)"id"!==e&&"value"!==e&&c.data(e,b[e]);return c.change()},clearValue:function(b){var c=this;if(c.length>1)return c.each(function(){a(this).streamComplete("clearValue")}),c;var e,d=c.data("streamcomplete");if(!d)throw h("InstanceError","A call to 'setValue' on an uninitialised object");for(c[0].value="",c.data("value",""),e=0;e<(b||[]).length;e++)this.data(b[e],"");return this.change()},updateOpts:function(b){var c=this;if(c.length>1)return c.each(function(){a(this).streamComplete("updateOpts",b)}),c;var d=this.data("streamcomplete");if(!d)throw h("InstanceError","A call to 'setValue' on an uninitialised object");return d.s=a.extend(d.s,b),c.data("streamcomplete",d),this}};a.fn.streamComplete=function(b){var c=this;return g[b]?g[b].apply(c,Array.prototype.slice.call(arguments,1)):"[object Object]"!==Object.prototype.toString.call(b)&&b?void a.error(["The method ",b," does not exist"].join("")):g.init.apply(c,arguments)}}(jQuery,0,this,this.document);
